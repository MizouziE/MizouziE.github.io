<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>MySQL Database Migration to a Remote Server from a .gz mysqldump file | web with mizouzie</title>
<meta name="keywords" content="mysql, tutorial, CLI, learning, linux" />
<script src="https://cdn.jsdelivr.net/gh/manucaralmo/GlowCookies@3.1.7/src/glowCookies.min.js"></script>
<script>
    glowCookies.start('en', { 
        style: 1,
        analytics: "G-MN6WKZ3S7T", 
        hideAfterClick: true,
        policyLink: '/privacy-policy',
        bannerDescription: '</br>As I am a web developer, I use cookies to learn about ways to make this site better, nothing sinister.</br></br>However, feel free to disable them here.</br></br>',
        bannerLinkText: 'Read Privacy policy',
        bannerHeading: '<h2>Cookies</h2>',
        acceptBtnText: 'Accept Cookies',
        acceptBtnColor: '#097969',
        acceptBtnBackground: '#ECFFDC',
        rejectBtnText: 'Reject Cookies',
        rejectBtnBackground: ' 	#E34234',
        rejectBtnColor: '#880808'
    });
</script>
<meta name="google-site-verification" content="psw8-5863N9APj0ZK5Lg3BMygE0vQEYIB7q2uJq-FPo" />
<meta property="og:image" content="https://www.mizouzie.dev/images/mysqldump-file-to-remote-server.png">
<meta property="og:image:width" content="1230">
<meta property="og:image:height" content="693">
<meta property="og:title" content="MySQL Database Migration to a Remote Server from a .gz mysqldump file | web with mizouzie">
<meta name="og:description" content="Some bugs only appear when your web application is truly tested out in production. The actual use cases of your data structure may differ from what you imagined, so make a dump of the prod DB and play around on a development server.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://www.mizouzie.dev/articles/mysql-database-migration-to-remote-server-from-gz-file/">
<meta property="twitter:title" content="MySQL Database Migration to a Remote Server from a .gz mysqldump file | web with mizouzie">
<meta name="twitter:description" content="Some bugs only appear when your web application is truly tested out in production. The actual use cases of your data structure may differ from what you imagined, so make a dump of the prod DB and play around on a development server.">
<meta property="twitter:image" content="https://www.mizouzie.dev/images/mysqldump-file-to-remote-server.png">
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:site" content="@mizouzie">
<meta property="twitter:creator" content="@mizouzie">
<meta name="description" content="Some bugs only appear when your web application is truly tested out in production. The actual use cases of your data structure may differ from what you imagined, so make a dump of the prod DB and play around on a development server.">
<meta name="author" content="Sam Anglin">
<link rel="canonical" href="https://www.mizouzie.dev/articles/mysql-database-migration-to-remote-server-from-gz-file/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.0023fee7fec5528a0c5f22e6800e893c5458542f625b2e4975b77acd921f7774.css" integrity="sha256-ACP&#43;5/7FUooMXyLmgA6JPFRYVC9iWy5Jdbd6zZIfd3Q=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js" integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5&#43;kdJvBz5iKbt6B5PJI="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://www.mizouzie.dev/images/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://www.mizouzie.dev/images/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://www.mizouzie.dev/images/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://www.mizouzie.dev/images/apple-touch-icon.png">
<link rel="mask-icon" href="https://www.mizouzie.dev/images/apple-touch-icon.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://www.mizouzie.dev/" accesskey="h" title="web with mizouzie (Alt + H)">web with mizouzie</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            
            <li>
                <a href="https://www.mizouzie.dev/articles/" title="Articles">
                    <span>Articles</span>
                </a>
            </li>
            <li>
                <a href="https://www.mizouzie.dev/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="https://www.mizouzie.dev/projects/" title="Projects">
                    <span>Projects</span>
                </a>
            </li>
            <li>
                <a href="https://www.mizouzie.dev/products/" title="Products">
                    <span>Products</span>
                </a>
            </li>
            <li>
                <a href="https://www.mizouzie.dev/contact/" title="Contact">
                    <span>Contact</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://www.mizouzie.dev/">Home</a>&nbsp;»&nbsp;<a href="https://www.mizouzie.dev/articles/">Articles</a></div>
    <h1 class="post-title">
      MySQL Database Migration to a Remote Server from a .gz mysqldump file
    </h1>
    <div class="post-description">
      Some bugs only appear when your web application is truly tested out in production. The actual use cases of your data structure may differ from what you imagined, so make a dump of the prod DB and play around on a development server.&nbsp;
    </div>
    <div class="post-meta"><span title='2023-07-01 00:00:00 +0000 UTC'>July 1, 2023</span>&nbsp;·&nbsp;12 min&nbsp;·&nbsp;Sam Anglin</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#introduction" aria-label="Introduction">Introduction</a><ul>
                        
                <li>
                    <a href="#tldr" aria-label="TL;DR">TL;DR</a></li>
                <li>
                    <a href="#use-case" aria-label="Use case">Use case</a><ul>
                        
                <li>
                    <a href="#particular-problems-we-face" aria-label="Particular problems we face">Particular problems we face</a></li>
                <li>
                    <a href="#other-uses" aria-label="Other uses">Other uses</a></li></ul>
                </li>
                <li>
                    <a href="#subjects-we-will-cover" aria-label="Subjects we will cover">Subjects we will cover</a></li></ul>
                </li>
                <li>
                    <a href="#steps" aria-label="Steps">Steps</a><ul>
                        
                <li>
                    <a href="#1-create-the-database" aria-label="1. Create the database">1. Create the database</a></li>
                <li>
                    <a href="#2-try-to-import-directly" aria-label="2. Try to import directly">2. Try to import directly</a></li>
                <li>
                    <a href="#3-read-the-mysqldump-file" aria-label="3. Read the mysqldump file">3. Read the mysqldump file</a></li>
                <li>
                    <a href="#4-skip-first-7-lines" aria-label="4. Skip first 7 lines">4. Skip first 7 lines</a></li>
                <li>
                    <a href="#5-read-further-down-the-file" aria-label="5. Read further down the file">5. Read further down the file</a></li>
                <li>
                    <a href="#6-set-important-server-variables" aria-label="6. Set important server variables">6. Set important server variables</a></li>
                <li>
                    <a href="#7-thats-what-she-sed" aria-label="7. That&amp;rsquo;s what she sed">7. That&rsquo;s what she <code>sed</code></a></li>
                <li>
                    <a href="#8-final-check-to-make-sure" aria-label="8. Final check to make sure">8. Final check to make sure</a></li></ul>
                </li>
                <li>
                    <a href="#final-working-command" aria-label="Final working command">Final working command</a></li>
                <li>
                    <a href="#summary" aria-label="Summary">Summary</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content">
    <p><img loading="lazy" src="/images/mysqldump-file-to-remote-server.png" alt="Title image"  />
</p>
<h2 id="introduction">Introduction</h2>
<p>I had a task a few months back of discovering the cause of a bug in a production environment that just was not presenting itself in development, mostly due to the creators and users of the application having ever so slightly differing ideas about how the app should be used. This meant that in all of our testing while making the application, we never saw the bug that was being reported. The solution for this was to take a copy of the production database and use that in development to try and replicate the reported issue.</p>
<p>The application was a CMS (Content Management System) that had a few extra niceties that introduced a little more complex database structuring, so that could be one reason it was hard for the development team to preempt this problem. All the same, the tech lead went ahead and made a mysqldump file <code>blogs.sql.gz</code> and promptly forwarded it to me to get to work with figuring things out. All our development work is done on a dedicated development remote server, and I had the file on my local machine so I&rsquo;d need to extract and upload the file to the remote server, which was something  I had not previously done.</p>
<p>I will cover the steps I went through in order to discover how exactly how to get the database created and populated with the desired data. It was a journey of discover for me as I was making use of tools that I was familiar with as well as new (to me) tools and therefore had some steps that may not be deemed <em>necessary</em>, but I will include them as they taught me something and my goal is to share those lessons.</p>
<p>I had a few specific problems which I will explain in more detail further down, which caused a few of the extra steps I took so there is more to learn here than just uploading data. As well as just documenting my thought process for my own benefit, I hope to offer some guidance to other junior developers in ways to approach the type of problems that cost us a lot of time when we are starting out.</p>
<h3 id="tldr">TL;DR</h3>
<p>I went through steps that allowed me to read the dump file, attempted to pipe that to the remote server, read the error messages and made whatever changes I needed and repeated until I had what I needed and eventually uploaded the data so I could have an exact copy of production on my development environment.</p>
<p>Skip down to <a href="#final-working-command">Final working Command</a> to see the command I ended up with.</p>
<h3 id="use-case">Use case</h3>
<p>In the case I am presenting here we have;</p>
<ul>
<li>a zipped mysqldump file (.gz) located in <code>./Downloads/blogs.sql.gz</code></li>
<li>the file contains a number of <code>mysqldump: [Warning]/Error...</code> lines (due to being made with/without a password)</li>
<li>a remote server to which we have ssh access, denoted by <code>&lt;user&gt;@&lt;hostname&gt;</code></li>
<li>mysql installed on said server</li>
</ul>
<h4 id="particular-problems-we-face">Particular problems we face</h4>
<p>The first stumbling block was the warnings that do not parse normally when uploading a mysqldump file. Their presence breaks the stream and so nothing after them will be read. I ended up solving this problem in more than one way as you will see by the end. My first &ldquo;solution&rdquo; introduced new problems that became apparent later on.</p>
<h4 id="other-uses">Other uses</h4>
<p>There is no reason I see that the working knowledge highlighted in the rest of this article cannot be beneficial to other use cases where, for example, a mysql dump file devoid of any warnings needs to be uploaded. I will break down each part of any commands we examine, so you can decide which you need to apply for your case.</p>
<h3 id="subjects-we-will-cover">Subjects we will cover</h3>
<p>A number of tools will be covered, so I will introduce them briefly here and explain their specific uses and additional flags when appropriate.</p>
<table>
<thead>
<tr>
<th>Command</th>
<th style="text-align:right">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>gzip</td>
<td style="text-align:right">compress or expand files</td>
</tr>
<tr>
<td>tail</td>
<td style="text-align:right">output the last part of files</td>
</tr>
<tr>
<td>head</td>
<td style="text-align:right">output the first part of files</td>
</tr>
<tr>
<td>ssh</td>
<td style="text-align:right">OpenSSH remote login client</td>
</tr>
<tr>
<td>mysql</td>
<td style="text-align:right">a simple SQL shell that supports interactive use</td>
</tr>
<tr>
<td>sed</td>
<td style="text-align:right">stream editor for filtering and transforming text</td>
</tr>
<tr>
<td>| (pipe)</td>
<td style="text-align:right">help combine two or more commands and are used as input/output concepts in a command.</td>
</tr>
</tbody>
</table>
<h2 id="steps">Steps</h2>
<p>You can see the whole raw interaction I had by clicking <a href="/../../mysqldump-steps">here</a> and see the MySQL set up by clicking <a href="/../../mysql-setup">here</a>.</p>
<h3 id="1-create-the-database">1. Create the database</h3>
<p>The first step is to use <code>ssh</code> to access the development server and be able to make changes using the <code>mysql</code> shell to add a new database that we will populate from the dump file.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">sam@Mizouzie:~$ ssh &lt;user&gt;@&lt;hostname&gt; -A
</code></pre></div><p>This will get us in.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">&lt;user&gt;@&lt;hostname&gt;:$ mysql
Welcome to the MariaDB monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span>.
Your MariaDB connection id is <span class="m">15401</span>
Server version: 10.6.12-MariaDB-1:10.6.12+maria~deb11 mariadb.org binary distribution

Copyright <span class="o">(</span>c<span class="o">)</span> 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type <span class="s1">&#39;help;&#39;</span> or <span class="s1">&#39;\h&#39;</span> <span class="k">for</span> help. Type <span class="s1">&#39;\c&#39;</span> to clear the current input statement.
</code></pre></div><p>Now on the development server, use the <code>mysql</code> command to open the shell client.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">MariaDB <span class="o">[(</span>none<span class="o">)]</span>&gt; show databases<span class="p">;</span>
+-----------------------+
<span class="p">|</span> Database              <span class="p">|</span>
+-----------------------+
<span class="p">|</span> information_schema    <span class="p">|</span>
<span class="p">|</span> content_generator     <span class="p">|</span>
<span class="p">|</span> example_laravel       <span class="p">|</span>
<span class="p">|</span> next_con_gen          <span class="p">|</span>
+-----------------------+
<span class="m">4</span> rows in <span class="nb">set</span> <span class="o">(</span>0.001 sec<span class="o">)</span>

MariaDB <span class="o">[(</span>none<span class="o">)]</span>&gt; create database example_laravel_dummy
    -&gt; <span class="p">;</span>
Query OK, <span class="m">1</span> row affected <span class="o">(</span>0.000 sec<span class="o">)</span>

MariaDB <span class="o">[(</span>none<span class="o">)]</span>&gt; show databases<span class="p">;</span>
+--------------------------+
<span class="p">|</span> Database                 <span class="p">|</span>
+--------------------------+
<span class="p">|</span> information_schema       <span class="p">|</span>
<span class="p">|</span> content_generator        <span class="p">|</span>
<span class="p">|</span> example_laravel          <span class="p">|</span>
<span class="p">|</span> example_laravel_dummy    <span class="p">|</span>
<span class="p">|</span> next_con_gen             <span class="p">|</span>
+--------------------------+
<span class="m">5</span> rows in <span class="nb">set</span> <span class="o">(</span>0.001 sec<span class="o">)</span>
</code></pre></div><p>Use <code>show databases;</code> to check existing databases In this case our development DB is <strong>example_laravel</strong> so we will create a dummy version <strong>example_laravel_dummy</strong> which we&rsquo;ll use later. Use <code>show databases;</code> once more to confirm it was created.</p>
<h3 id="2-try-to-import-directly">2. Try to import directly</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">sam@MizouziE:~$ ssh &lt;user&gt;@&lt;hostname&gt; -A <span class="s2">&#34;mysql -u sam -p example_laravel_dummy&#34;</span> &lt; ./Downloads/blogs.sql.gz 
Enter password: ERROR <span class="m">1045</span> <span class="o">(</span>28000<span class="o">)</span>: Access denied <span class="k">for</span> user <span class="s1">&#39;sam&#39;</span>@<span class="s1">&#39;localhost&#39;</span> <span class="o">(</span>using password: YES<span class="o">)</span>
</code></pre></div><p>Here we are using <code>ssh</code> and feeding a command into it by passing a string between quotation marks. Effectively we are running <code>mysql -u sam -p example_laravel_dummy</code> <strong>on</strong> the remote server but <strong>from</strong> our local machine.</p>
<p>I should not have used the <code>-p</code> flag for a password, so let&rsquo;s omit that.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">sam@MizouziE:~$ ssh &lt;user&gt;@&lt;hostname&gt; -A <span class="s2">&#34;mysql -u sam example_laravel_dummy&#34;</span> &lt; ./Downloads/blogs.sql.gz 
ERROR: ASCII <span class="s1">&#39;\0&#39;</span> appeared in the statement, but this is not allowed unless option --binary-mode is enabled and mysql is run in non-interactive mode. Set --binary-mode to <span class="m">1</span> <span class="k">if</span> ASCII <span class="s1">&#39;\0&#39;</span> is expected. Query: Sd<span class="err">&#39;</span>.
</code></pre></div><p>Now the file format is a problem as we have not extracted it.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">sam@MizouziE:~$ ssh &lt;user&gt;@&lt;hostname&gt; -A <span class="s2">&#34;mysql -u sam example_laravel_dummy&#34;</span> &lt; gzip -dk ./Downloads/blogs.sql.gz 
bash: gzip: No such file or directory
</code></pre></div><p>We need to install <code>gzip</code>, so go ahead and do that.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">sam@MizouziE:~$ gzip -cd ./Downloads/blogs.sql.gz <span class="p">|</span> ssh &lt;user&gt;@&lt;hostname&gt; -A <span class="s2">&#34;mysql example_laravel_dummy&#34;</span>
ERROR <span class="m">1064</span> <span class="o">(</span>42000<span class="o">)</span> at line 1: You have an error in your SQL syntax<span class="p">;</span> check the manual that corresponds to your MariaDB server version <span class="k">for</span> the right syntax to use near <span class="s1">&#39;mysqldump: [Warning] Using a password on the command line interface can be in...&#39;</span> at line <span class="m">1</span>
</code></pre></div><p>The two flags used <code>-c</code> &amp; <code>-d</code> with <code>gzip</code> will write the output on to standard output and decompress which is what allows us the then pipe that output into our following <code>ssh</code> command.</p>
<p>Also note that we have inverted the command to run <code>gzip</code> first so that we pipe the output of that into the <code>ssh</code> command.</p>
<p>Our new error indicates a syntax error in the SQL statement we wish to run via the <code>mysql</code> command. That brings us to the next step.</p>
<h3 id="3-read-the-mysqldump-file">3. Read the mysqldump file</h3>
<p>In order to see why and where we have this issue, we can use the <code>head</code> command to read the first 10 lines of the file after unzipping it.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">sam@MizouziE:~$ gzip -cd ./Downloads/blogs.sql.gz <span class="p">|</span> head
mysqldump: <span class="o">[</span>Warning<span class="o">]</span> Using a password on the <span class="nb">command</span> line interface can be insecure.
-- MySQL dump 10.13  Distrib 8.0.33, <span class="k">for</span> Linux <span class="o">(</span>aarch64<span class="o">)</span>
--
-- Host: localhost    Database: blogs
-- ------------------------------------------------------
-- Server version	8.0.33

/*!40101 SET @OLD_CHARACTER_SET_CLIENT<span class="o">=</span>@@CHARACTER_SET_CLIENT */<span class="p">;</span>
/*!40101 SET @OLD_CHARACTER_SET_RESULTS<span class="o">=</span>@@CHARACTER_SET_RESULTS */<span class="p">;</span>
/*!40101 SET @OLD_COLLATION_CONNECTION<span class="o">=</span>@@COLLATION_CONNECTION */<span class="p">;</span>
</code></pre></div><p>We can see by this output that the line beginning with <code>mysqldump: [Warning]</code> is problematic and not recognised as proper SQL syntax. Furthermore, the following lines are commented out so they could also be omitted.</p>
<h3 id="4-skip-first-7-lines">4. Skip first 7 lines</h3>
<p>So as our first 7 lines contain bad syntax and useless information, let&rsquo;s send the same output but without the first 7 lines. Similar to <code>head</code>, we can use <code>tail</code> to send everything after a specified line number by making use of the <code>-n</code> flag with a positive (+) integer.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">sam@MizouziE:~$ gzip -cd ./Downloads/blogs.sql.gz <span class="p">|</span> tail -n +7 <span class="p">|</span> ssh &lt;user&gt;@&lt;hostname&gt; -A <span class="s2">&#34;mysql example_laravel_dummy&#34;</span>
ERROR <span class="m">1064</span> <span class="o">(</span>42000<span class="o">)</span> at line 12: You have an error in your SQL syntax<span class="p">;</span> check the manual that corresponds to your MariaDB server version <span class="k">for</span> the right syntax to use near <span class="s1">&#39;mysqldump: Error: &#39;</span>Access denied<span class="p">;</span> you need <span class="o">(</span>at least one of<span class="o">)</span> the PROCESS priv...<span class="err">&#39;</span> at line <span class="m">1</span>
</code></pre></div><p>New error, but similar to the one we came across before. This means we must delve a little deeper down the file.</p>
<h3 id="5-read-further-down-the-file">5. Read further down the file</h3>
<p>We can use a <code>-n</code> flag on head to specify the number of lines shown. Without this flag it defaults to 10, so we will use a higher number to see more than before.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">sam@MizouziE:~$ gzip -cd ./Downloads/blogs.sql.gz <span class="p">|</span> head -n <span class="m">25</span>
mysqldump: <span class="o">[</span>Warning<span class="o">]</span> Using a password on the <span class="nb">command</span> line interface can be insecure.
-- MySQL dump 10.13  Distrib 8.0.33, <span class="k">for</span> Linux <span class="o">(</span>aarch64<span class="o">)</span>
--
-- Host: localhost    Database: blogs
-- ------------------------------------------------------
-- Server version	8.0.33

/*!40101 SET @OLD_CHARACTER_SET_CLIENT<span class="o">=</span>@@CHARACTER_SET_CLIENT */<span class="p">;</span>
/*!40101 SET @OLD_CHARACTER_SET_RESULTS<span class="o">=</span>@@CHARACTER_SET_RESULTS */<span class="p">;</span>
/*!40101 SET @OLD_COLLATION_CONNECTION<span class="o">=</span>@@COLLATION_CONNECTION */<span class="p">;</span>
/*!50503 SET NAMES UTF8 */<span class="p">;</span>
/*!40103 SET @OLD_TIME_ZONE<span class="o">=</span>@@TIME_ZONE */<span class="p">;</span>
/*!40103 SET <span class="nv">TIME_ZONE</span><span class="o">=</span><span class="s1">&#39;+00:00&#39;</span> */<span class="p">;</span>
/*!40014 SET @OLD_UNIQUE_CHECKS<span class="o">=</span>@@UNIQUE_CHECKS, <span class="nv">UNIQUE_CHECKS</span><span class="o">=</span><span class="m">0</span> */<span class="p">;</span>
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS<span class="o">=</span>@@FOREIGN_KEY_CHECKS, <span class="nv">FOREIGN_KEY_CHECKS</span><span class="o">=</span><span class="m">0</span> */<span class="p">;</span>
/*!40101 SET @OLD_SQL_MODE<span class="o">=</span>@@SQL_MODE, <span class="nv">SQL_MODE</span><span class="o">=</span><span class="s1">&#39;NO_AUTO_VALUE_ON_ZERO&#39;</span> */<span class="p">;</span>
/*!40111 SET @OLD_SQL_NOTES<span class="o">=</span>@@SQL_NOTES, <span class="nv">SQL_NOTES</span><span class="o">=</span><span class="m">0</span> */<span class="p">;</span>
mysqldump: Error: <span class="s1">&#39;Access denied; you need (at least one of) the PROCESS privilege(s) for this operation&#39;</span> when trying to dump tablespaces

--
-- Table structure <span class="k">for</span> table <span class="sb">`</span>activity_log<span class="sb">`</span>
--

DROP TABLE IF EXISTS <span class="sb">`</span>activity_log<span class="sb">`</span><span class="p">;</span>
/*!40101 SET @saved_cs_client     <span class="o">=</span> @@character_set_client */<span class="p">;</span>
</code></pre></div><p>In this output we see that there is another error message that breaks syntax rules. This one follows after a number of settings that may be safe to assume are ok by default, so we will try to use <code>tail</code> like before but from ven further down the file.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">sam@MizouziE:~$ gzip -cd ./Downloads/blogs.sql.gz <span class="p">|</span> tail -n +24 <span class="p">|</span> ssh &lt;user&gt;@&lt;hostname&gt; -A <span class="s2">&#34;mysql example_laravel_dummy&#34;</span>
ERROR <span class="m">1005</span> <span class="o">(</span>HY000<span class="o">)</span> at line 96: Can<span class="err">&#39;</span>t create table <span class="sb">`</span>example_laravel_dummy<span class="sb">`</span>.<span class="sb">`</span>article_background_image<span class="sb">`</span> <span class="o">(</span>errno: <span class="m">150</span> <span class="s2">&#34;Foreign key constraint is incorrectly formed&#34;</span><span class="o">)</span>
</code></pre></div><p>Now we see that this will not work because we omitted something important. Namely the line <code>/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;</code>.</p>
<h3 id="6-set-important-server-variables">6. Set important server variables</h3>
<p>We can try to set the missing server variable and keep our current way of feeding the SQL statement by using <code>--init command=[command]</code> after <code>mysql</code>. We will use that to disable the foreign key checks.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">sam@MizouziE:~$ gzip -cd ./Downloads/blogs.sql.gz <span class="p">|</span> tail -n +24 <span class="p">|</span> ssh &lt;user&gt;@&lt;hostname&gt; -A <span class="s2">&#34;mysql --init-command=\&#34;SET SESSION FOREIGN_KEY_CHECKS=0;\&#34; example_laravel_dummy&#34;</span>
ERROR <span class="m">1231</span> <span class="o">(</span>42000<span class="o">)</span> at line 2261: Variable <span class="s1">&#39;time_zone&#39;</span> can<span class="s1">&#39;t be set to the value of &#39;</span>NULL<span class="err">&#39;</span>
</code></pre></div><p>Here we have yet a different error, but it&rsquo;s cause is very similar to the last error we encountered. It is down to omitting those seemingly &ldquo;safe to omit&rdquo; server variables from the start of the mysqldump file. We need another approach.</p>
<h3 id="7-thats-what-she-sed">7. That&rsquo;s what she <code>sed</code></h3>
<p><code>sed</code> now makes itself useful to us as we can use it with it&rsquo;s regexp matching ability to <em>remove</em> certain lines from the file stream as they are being streamed. What I mean is, we will just drop out the lines starting with the <code>mysqldump: </code> that are causing us headache.</p>
<p>We achieve this by putting &lsquo;mysqldump:&rsquo; in a regexp that deletes any line starting with it as follows; <code>'/mysqldump:/d'</code>. It&rsquo;s the lowercase &rsquo;d' that does the business.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">sam@MizouziE:~$ gzip -cd ./Downloads/blogs.sql.gz <span class="p">|</span> sed <span class="s1">&#39;/mysqldump:/d&#39;</span> <span class="p">|</span> ssh &lt;user&gt;@&lt;hostname&gt; -A <span class="s2">&#34;mysql --init-command=\&#34;SET SESSION FOREIGN_KEY_CHECKS=0;\&#34; example_laravel_dummy&#34;</span>
sam@MizouziE:~$
</code></pre></div><p>And look at that, <strong>no error</strong>! That means it worked.</p>
<blockquote>
<p>There is one thing not entirely necessary here, though. If you spot it shoot me a DM on twitter <a href="https://twitter.com/mizouzie">@mizouzie</a></p>
</blockquote>
<h3 id="8-final-check-to-make-sure">8. Final check to make sure</h3>
<p>Now all that is left to do is check on our mysql instance on the remote server if everything is as we expect.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">
MariaDB <span class="o">[</span>example_laravel_dummy<span class="o">]</span>&gt; show tables<span class="p">;</span>
+------------------------------------+
<span class="p">|</span> Tables_in_example_laravel_dummy <span class="p">|</span>
+------------------------------------+
<span class="p">|</span> activity_log                       <span class="p">|</span>
<span class="p">|</span> article_article                    <span class="p">|</span>
<span class="p">|</span> article_author                     <span class="p">|</span>
<span class="p">|</span> article_background_image           <span class="p">|</span>
<span class="p">|</span> article_category                   <span class="p">|</span>
<span class="p">|</span> article_revisions                  <span class="p">|</span>
<span class="p">|</span> article_site                       <span class="p">|</span>
<span class="p">|</span> article_slugs                      <span class="p">|</span>
<span class="p">|</span> articles                           <span class="p">|</span>
<span class="p">|</span> author_revisions                   <span class="p">|</span>
<span class="p">|</span> author_slugs                       <span class="p">|</span>
<span class="p">|</span> authors                            <span class="p">|</span>
<span class="p">|</span> background_images                  <span class="p">|</span>
<span class="p">|</span> background_images_revisions        <span class="p">|</span>
<span class="p">|</span> blocks                             <span class="p">|</span>
<span class="p">|</span> categories                         <span class="p">|</span>
<span class="p">|</span> category_revisions                 <span class="p">|</span>
<span class="p">|</span> category_site                      <span class="p">|</span>
<span class="p">|</span> category_slugs                     <span class="p">|</span>
<span class="p">|</span> failed_jobs                        <span class="p">|</span>
<span class="p">|</span> features                           <span class="p">|</span>
<span class="p">|</span> fileables                          <span class="p">|</span>
<span class="p">|</span> files                              <span class="p">|</span>
<span class="p">|</span> imports                            <span class="p">|</span>
<span class="p">|</span> linked_images                      <span class="p">|</span>
<span class="p">|</span> links                              <span class="p">|</span>
<span class="p">|</span> mediables                          <span class="p">|</span>
<span class="p">|</span> medias                             <span class="p">|</span>
<span class="p">|</span> menu_revisions                     <span class="p">|</span>
<span class="p">|</span> menus                              <span class="p">|</span>
<span class="p">|</span> migrations                         <span class="p">|</span>
<span class="p">|</span> password_resets                    <span class="p">|</span>
<span class="p">|</span> provider_revisions                 <span class="p">|</span>
<span class="p">|</span> provider_slugs                     <span class="p">|</span>
<span class="p">|</span> providers                          <span class="p">|</span>
<span class="p">|</span> ratings                            <span class="p">|</span>
<span class="p">|</span> redirects                          <span class="p">|</span>
<span class="p">|</span> related                            <span class="p">|</span>
<span class="p">|</span> setting_translations               <span class="p">|</span>
<span class="p">|</span> settings                           <span class="p">|</span>
<span class="p">|</span> site_revisions                     <span class="p">|</span>
<span class="p">|</span> site_user                          <span class="p">|</span>
<span class="p">|</span> sites                              <span class="p">|</span>
<span class="p">|</span> slider_revisions                   <span class="p">|</span>
<span class="p">|</span> sliders                            <span class="p">|</span>
<span class="p">|</span> string_translation_revisions       <span class="p">|</span>
<span class="p">|</span> string_translations                <span class="p">|</span>
<span class="p">|</span> tagged                             <span class="p">|</span>
<span class="p">|</span> tags                               <span class="p">|</span>
<span class="p">|</span> twill_password_resets              <span class="p">|</span>
<span class="p">|</span> twill_users                        <span class="p">|</span>
<span class="p">|</span> users                              <span class="p">|</span>
+------------------------------------+
<span class="m">52</span> rows in <span class="nb">set</span> <span class="o">(</span>0.001 sec<span class="o">)</span>

MariaDB <span class="o">[</span>example_laravel_dummy<span class="o">]</span>&gt; ^DBye
</code></pre></div><p>Nice, we have all our tables and then we exit with <code>Ctrl + D</code>.</p>
<h2 id="final-working-command">Final working command</h2>
<p>After all our experimenting we got what we wanted, so our final command to do what we want looks like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">sam@MizouziE:~$ gzip -cd ./Downloads/blogs.sql.gz <span class="p">|</span> sed <span class="s1">&#39;/mysqldump:/d&#39;</span> <span class="p">|</span> ssh &lt;user&gt;@&lt;hostname&gt; -A <span class="s2">&#34;mysql example_laravel_dummy&#34;</span>
</code></pre></div><p>So for any other use case, or just a a breakdown of each part, we had something like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">&lt;user&gt;@&lt;localhost&gt;:~$ gzip -cd &lt;location/of/mysqldump.sql.gz&gt; <span class="p">|</span> sed <span class="s1">&#39;/&lt;beginning of line to remove&gt;/d&#39;</span> <span class="p">|</span> ssh &lt;user&gt;@&lt;hostname&gt; -A <span class="s2">&#34;mysql &lt;name_of_database&gt;&#34;</span>
</code></pre></div><p>So the command does this:</p>
<ol>
<li>Unzip the file</li>
<li>Pipe the stream of the file output through <code>sed</code></li>
<li>Filter out undesired lines with <code>sed</code></li>
<li>Pipe the result of that to <code>ssh</code></li>
<li>With <code>ssh</code> execute the <code>mysql</code> command and feed the piped stream to a named database</li>
</ol>
<p>This all works because the zipped mysqldump file is essentially one big SQL statement that can recreate all tables and insert all data that was in the database it was taken from. They tend to be quite large files, hence the need to zip them.</p>
<h2 id="summary">Summary</h2>
<p>This was a series of steps that ended up giving the desired results. There were probably a number of different ways to arrive at teh same conclusion, or even ways to arrive at a different conclusion that gave the same result. That is the cool thing about working in this field, we have a multitude of tools that can do small parts of a solution to a problem. It is up to us to do exercises like this to learn how to combine them into something that gives a result. That is what we software engineers get paid for. Practice problems like this, you&rsquo;ll learn loads!</p>

  </div>

  <footer class="post-footer">
    
    
    <h3>See Also</h3>
    <ul>
      
      <li><a href="/articles/3-ways-to-read-input-with-go-cli/">3 ways to read input with a Go CLI</a></li>
      
      <li><a href="/products/lila/">Lila</a></li>
      
      <li><a href="/products/rework/">REWORK</a></li>
      
      <li><a href="/articles/how-to-test-protected-functions-with-phpunit/">How to test protected functions with PHPUnit in your Laravel app</a></li>
      
      <li><a href="/articles/space-is-the-place/">Space is the Place: Reasons to explore Twitter Spaces</a></li>
      
    </ul>
    
    <ul class="post-tags">
      <li><a href="https://www.mizouzie.dev/tags/mysql/">mysql</a></li>
      <li><a href="https://www.mizouzie.dev/tags/tutorial/">tutorial</a></li>
      <li><a href="https://www.mizouzie.dev/tags/cli/">CLI</a></li>
      <li><a href="https://www.mizouzie.dev/tags/learning/">learning</a></li>
      <li><a href="https://www.mizouzie.dev/tags/linux/">linux</a></li>
    </ul>
    <br>
    <br>
    <h4>Share this Post:</h4>

<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share MySQL Database Migration to a Remote Server from a .gz mysqldump file on twitter"
        href="https://twitter.com/intent/tweet/?text=MySQL%20Database%20Migration%20to%20a%20Remote%20Server%20from%20a%20.gz%20mysqldump%20file&amp;url=https%3a%2f%2fwww.mizouzie.dev%2farticles%2fmysql-database-migration-to-remote-server-from-gz-file%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share MySQL Database Migration to a Remote Server from a .gz mysqldump file on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fwww.mizouzie.dev%2farticles%2fmysql-database-migration-to-remote-server-from-gz-file%2f&amp;title=MySQL%20Database%20Migration%20to%20a%20Remote%20Server%20from%20a%20.gz%20mysqldump%20file&amp;summary=MySQL%20Database%20Migration%20to%20a%20Remote%20Server%20from%20a%20.gz%20mysqldump%20file&amp;source=https%3a%2f%2fwww.mizouzie.dev%2farticles%2fmysql-database-migration-to-remote-server-from-gz-file%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share MySQL Database Migration to a Remote Server from a .gz mysqldump file on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2fwww.mizouzie.dev%2farticles%2fmysql-database-migration-to-remote-server-from-gz-file%2f&title=MySQL%20Database%20Migration%20to%20a%20Remote%20Server%20from%20a%20.gz%20mysqldump%20file">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share MySQL Database Migration to a Remote Server from a .gz mysqldump file on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.mizouzie.dev%2farticles%2fmysql-database-migration-to-remote-server-from-gz-file%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    




</div>
<br><br>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>made by MizouziE</span>
      
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>


<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
